{% extends "RRIT/index.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
{{ block.super }}

<script src="{% url 'admin:jsi18n' %}"></script>

{% endblock %}

{% block extrahead %}
{{ block.super }}
{{ media.js }}
<script src="{% static 'admin/js/filters.js' %}" defer></script>
<script src="/static/admin/js/vendor/jquery/jquery.js"></script>
<script src="/static/admin/js/jquery.init.js"></script>
<script src="/static/admin/js/core.js"></script>
<script src="/static/admin/js/admin/RelatedObjectLookups.js"></script>
<script src="/static/admin/js/actions.js"></script>
<script src="/static/admin/js/urlify.js"></script>
<script src="/static/admin/js/prepopulate.js"></script>
<script src="/static/admin/js/vendor/xregexp/xregexp.js"></script>
<script src="/static/admin/js/filters.js" defer></script>


<link rel="stylesheet" href="{% static "leaflet.css" %} " />

<link rel="stylesheet" href="{% static "map.css" %} " />
<!---<link rel="stylesheet" href="{% static "add.css" %} " />--!>
<script src="{% static "leaflet.js" %}"></script>
<script src="{% static "map.js" %}"></script>

<link rel="stylesheet" href="{% static "bootstrap/css/bootstrap.css" %} " />
{% endblock %}

{% block bodyclass %} app-{{ action_model }} model-{{ action_models_s }} change-list{% endblock %}
{% block sidebar %}
{% endblock %}
{% block nav-breadcrumbs %}
{% include "RRIT/navigation.html" %}

{% endblock %}


{% block nav-sidebar %}
{% include "RRIT/nav_sidebar.html" %}
{% endblock %}
{% block content %}
<div class="container1">
    <div class="row1">
        <div class="col-sm">
            <div style="text-align: center;">Добавить новый инцидент</div>
            <div id="map"
                 style="width:750px; height: 450px; position:relative; text-align:center; margin-top: 10px;"></div>

        </div>
        <div class="col-sm">
            <div style="text-align: center;">Описание</div>
            <label for="" class="form-label">Адрес</label>
            <div class="input-group mb-3">
                <input type="text" class="form-control" aria-label="Sizing example input"
                       aria-describedby="inputGroup-sizing-default" >
            </div>

            <div class="input-group">
                <span class="input-group-text">Адрес</span>
                <input type="" id="address" class="form-control" placeholder="Адрес" readonly>
            </div>

            <div class="input-group">
                <span class="input-group-text">Координаты</span>
                <input type="" id="lat" class="form-control" placeholder="Широта" readonly>
                <input type="" id="lng" class="form-control" placeholder="Долгота" readonly>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
            create_map([55.760748705787165, 37.626156387675145], 5);
             var marker = {};
         map.on('click', function(e)
         {

                 if (marker != undefined) {
                    map.removeLayer(marker);
                 };
               marker = L.marker(e.latlng).addTo(map).on('click', e => e.target.remove());
               var latHtml = document.getElementById('lat');
               latHtml.value = e.latlng.lat;
               var lonHtml = document.getElementById('lng');
               lonHtml.value = e.latlng.lng;

               var url = "http://suggestions.dadata.ru/suggestions/api/4_1/rs/geolocate/address";
               var token = "48dd8e7ec5d6409bf6586b38ac4c36b98ea34426";
               var query = { lat: e.latlng.lat, lon: e.latlng.lng };

                var options = {
                    method: "POST",
                    mode: "cors",
                    count: 1,
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/json",
                        "Authorization": "Token " + token
                    },
                    body: JSON.stringify(query),
                    count: 1,
                }

                fetch(url, options)
                .then(response => response.json())
                .then(result => document.getElementById('address').value = result.suggestions[0].value)
                .catch(error => console.log("error", error));

               var addressHtml = document.getElementById('address');
               addressHtml.value = '123';

         });
    });


</script>


{% endblock %}
